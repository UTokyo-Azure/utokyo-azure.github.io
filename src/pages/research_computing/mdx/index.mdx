---
title: "mdx"
breadcrumb:
  title: "mdx I"
---

## mdx (データ活用社会創成プラットフォーム) とは

クラウド上の仮想マシンを安価に利用できるサービスで、全国共同利用のサービスとして東京大学だけでなく全国の教育研究機関に対して提供されています。
このサービスは、分野を超えたデータ科学や情報科学の知見、様々なデータやソフトウエアなどを迅速かつ効率的に連携させたデータ活用の実現を目的とし、データ活用社会創成プラットフォーム協働事業体によって運用されています。

利用できる仮想マシンは、mdx I と呼ばれる高性能計算機上に仮想的に作られたコンピュータ (PC) です。
仮想マシンは、例えば ssh を通じてサーバ計算機として利用したり、デスクトップ画面を備えた普通の PC として利用することもできます。
後者の場合、デスクトップ画面は手元の web ブラウザ経由で操作します。
GPU を搭載した仮想マシンを利用できる他、大容量のストレージも提供しています。
申請すれば仮想マシンにグローバル IP アドレスを付与することも可能です。

利用料金は[こちら](https://mdx.jp/mdx1/p/guide/charge) からわかります。
2024 年度の場合、1 CPU パックが１円で、おおよそ仮想コア１個 1.5 GB の仮想マシンを１時間利用できます。
3 コアで 4.5 GB の仮想マシンを web サーバなどとして常時稼働させるとすると、１ヶ月 720 時間として一月あたり約 432 円です。
これ以外にストレージの利用料が、例えば 40GB で月に 36 円ほどかかかりますが、類似の民間サービスに比べて安価に抑えられています。

利用料金は仮想マシンが稼働している間だけかかります。
大規模な並列計算をおこないたいときは、計算が終わり次第仮想マシンを止めれば、無駄に利用料を負担する必要がなくなります。
止まっている間、CPU やメモリは他の利用者の仮想マシンを動かすために流用されますが、ストレージは流用されないので、ファイルなどを他の利用者にのぞき見られる心配はありません。
そのかわり、仮想マシンが止まっている間もストレージとの利用料はかかります。

## 使ってみる

### プロジェクトの作成

mdx I を利用するには、まず自身のプロジェクトを作成します。

[mdx I のトップページ](https://mdx.jp/mdx1) の「プロジェクト申請（新規）」をクリックして、プロジェクト申請ポータルへ移動します。
アカウントの管理は国立情報学研究所の学認（学術認証フェデレーション）が使われています。
「所属機関」に東京大学を選んで「選択」をクリックすると、UTokyo アカウントでログインできます。
次のページで東京大学のメールアドレスを入力して「Send Token」をクリックします。
認証用のトークンがメールで届くので、トークンをコピーしてログイン画面に入力するか、メール中の URL
をクリックすると認証が完了して、プロジェクト申請ポータルの画面が開きます。

プロジェクト申請ポータルのトップページは、申請済みのプロジェクト一覧です。
このページの上部の「プロジェクトの申請」をクリックして申請画面を開きます。

- プロジェクトタイプは「通常」でよいでしょう。

- 連携機関は「東京大学情報基盤センター」を選んでください。

ページ下部の「申請」をクリックすると申請完了です。
職員が目視で申請内容を確ししていますから、承認されるまで少し時間がかかります。

プロジェクトは mdx の利用グループごとに作ることができます。
一人で複数のプロジェクトを作ることもできます。


### ポイントの購入

プロジェクトを作成したら「ポイント」を購入します。mdx は前払いのプリペイド方式です。

ポイントの購入は、プロジェクトの申請と同じ*プロジェクト申請ポータル*からおこないます。
プロジェクト申請一覧のページの上部の「ポイントを購入する」をクリックします。

するとプロジェクトの一覧が表示され、各プロジェクトの行の右橋に「購入する」というボタンが現れます。
ポイントを購入したいプロジェクトの「購入する」をクリックします。

支払いには大学運営費の他、科研費などの外部資金も利用できます。
購入は 5,000 ポイント単位です。
5,000 ポイントを一口と呼び、購入する口数を入力します。
例えば 100,000 ポイント（10 万円）を購入するときは 20 口と入力します。

### 仮想マシンの利用

ポイントを購入したら仮想マシンを作成します。
作成にはユーザーポータルに移動します。
プロジェクト申請ポータルの上部の「User Portal」をクリックしても移動できますし、
[mdx I のトップページ](https://mdx.jp/mdx1) で「mdx の利用（ユーザポータルへ）」をクリックしても移動できます。

認証はプロジェクト申請ポータルと同様、学認です。
「所属機関」に東京大学を選んで「選択」をクリックして認証します。

ユーザポータルでは、まず、今自分が仮想マシンを作成しようとしているプロジェクトであるか確認します。
一番上の行に現プロジェクトが表示されています。
変更するにはプルダウンメニューで目的のプロジェクトを選びます。
詳しくは[ビデオ](https://www.youtube.com/watch?v=n98Z4tEt3kw)を見てください。

#### プロジェクトの資源量の申請

まずそのプロジェクトで利用する資源量（CPU や GPU の最大個数、ストレージの最大容量）を申請します。
mdx が提供できる資源量は有限なので、申請した資源量がそのまま承認されるとは限りませんが、空きがあれば承認されます（いったん申請が承認されても、混み具合に応じて再調整されることもあります）。
プロジェクト資源量の申請は、ユーザポータルの「プロジェクト」タブからおこないます。
ページ上部の「プロジェクト」をクリックして、「プロジェクト編集申請」をクリックします。

資源量のうち CPU と GPU には、*起動保証仮想マシン*と*スポット仮想マシン*という概念があります。
起動保証仮想マシンは、その名前のとおり、資源が予約されていて、必要なときにはいつでも起動できることが保証されているマシンです。
一方、スポット仮想マシンは、混雑してくると、強制的に休止状態になる可能性があります。休止状態に移行する前にはユーザに通知されます。

プロジェクト資源量の申請が必要なのは、起動保証仮想マシンの CPU と GPU だけです。
スポット仮想マシンは、申請した資源量に関係なく、空きがあればいつでも利用できます。
起動保証仮想マシンの CPU と GPU は、プロジェクトの全ての起動保証仮想マシンに CPU パックと GPU パックを合計でいくつ割り当てるかで指定します。

#### デプロイ

いよいよ仮想マシンを作成します。
ユーザポータルのページ上部にある「仮想マシン」タブをクリックします。
デプロイの手順を知るには[ビデオ](https://www.youtube.com/watch?v=hsvBUTtz7TM)も見てください。

ISO イメージから任意の OS をインスト−ルするこができますが、すでに用意されているテンプレートから選ぶのが簡単です。
ページ左側に「コントロール」「デプロイ」「ISO イメージ」と表示されるので、「デプロイ」を選びます。

例えば Ubuntu Desktop を選び、 「デプロイ」をクリックします。
CPU パックは 3 パック、仮想ディスクは 40GB などと入力します。
「デプロイ後起動する」にチェックを入れれば、デプロイ後に即座に仮想マシンが起動します。
スポット仮想マシンとしてデプロイする場合は、「起動保証仮想マシン」にチェックを入れません。

起動後、仮想マシンに ssh でログインできるように、自分の ssh の公開鍵を登録します。
そして「デプロイ」をクリックします。
デプロイには少し時間（１分弱）がかかりますが、「インフォメーション」タブの「操作履歴」から進捗状況を確認できます。

デプロイが完了したら「仮想マシン」タブに戻って左側の「コントロール」を選びます。
「デプロイ後起動する」をチェックしていれば、デプロイした仮想マシンが PowerOn になっているはずです。

デプロイした仮想マシンを選択して、「Console」をクリックすると、別ウィンドウで Ubuntu のデスクトップ画面が開きます。
テンプレートから Ubuntu を選んでいるのなら mdxuser でログインできます。

#### ネットワーク設定

インターネット経由で外部から仮想マシンに ssh 等でログインしたい場合は、グローバル IP アドレスを割り当てます。
そのためには、まずユーザポータルの「仮想マシン」タブの「コントロール」を選びます。
IP アドレスを割り当てたい仮想マシンを選んで、「メンテナンス」の「DNAT 設定」をクリックします。

しばらくすると、仮想マシンにグローバル IP アドレスが割り当てられます。
ユーザポータルの「仮想マシン」タブの「コントロール」で、目的の仮想マシンを選ぶと（仮想マシン名の左のラジオボタンをクリックする）、その仮想マシンの情報が表示されます。
その中のグローバル IP アドレスの欄に割り当てられたアドレスが記されています。

グローバル IP アドレスを割り当てたら [ACL (Access Control List) の設定](https://docs.mdx.jp/ja/index.html#network-acl
)をおこないます。
ACL によって必要な通信だけを許可して、仮想マシンを不正アクセスから守ります。

ユーザポータルの「ネットワーク」タブの左側の「ACL」をクリックします。
次に「Allow ACL」欄の「IPv4」タブを選び、「+ RECORD」をクリックします。

例えば ssh での通信を可能にするのなら、

- プロトコル: TCP
- Src アドレス: 0.0.0.0  （インターネット上の任意のアドレスからアクセス可能）
- Src Prefix 長: 0
- Src ポート: Any  （任意のポートからアクセス可能）
- Dst アドレス: アクセスを許す仮想マシンのグローバル IP アドレス
- Dst Prefix 長: 32  （Dst アドレスの仮想マシンだけにアクセスを許す）
- Dst ポート: 22  （ssh の場合。 Web サーバなら 80 と 443 など）

のように設定して「Add」をクリックします。

#### 起動と停止

起動した計算機は、通常の手順でシャットダウンすれば計算機も停止します。
ユーザポータルの「仮想マシン」タブの「コントロール」を選ぶと（場合によってはページをリロードすると）、状態が PowerOFF に変わっているはずです。

計算機を再度起動する場合は、「仮想マシン」タブの「コントロール」から、起動したい計算機を選んで、「Action」の「電源」、「起動」をクリックします。
